[pytest]
# Default command-line options
addopts = [
  "--cov-report=html",
  "--cov-report=term-missing",
  "--cov-report=xml",
  # Coverage options
  "--cov=genanki_next",
  # Performance
  "--durations=10",  # Show 10 slowest tests
  # Output options
  "--tb=short",  # Shorter traceback format
  "-W error",  # Turn warnings into errors
  "-ra",  # Show summary of all test outcomes
]
# Console output style
console_output_style = "progress"
# Doctest configuration
doctest_optionflags = [
  "ELLIPSIS",
  "IGNORE_EXCEPTION_DETAIL",
  "NORMALIZE_WHITESPACE",
]
faulthandler_exit_on_timeout = false
# Timeout for tests (requires pytest-timeout plugin)
faulthandler_timeout = "300"
# Filter warnings
filterwarnings = [
  "error",  # Turn all warnings into errors
  "ignore::DeprecationWarning:pkg_resources",  # Ignore pkg_resources deprecations
  "ignore::PendingDeprecationWarning",  # Ignore pending deprecations
]
junit_duration_report = "call"
# JUnit XML report configuration
junit_family = "xunit2"
junit_log_passing_tests = true
junit_logging = "all"
junit_suite_name = "genanki_next"
# Disable auto-indentation of multiline log messages
log_auto_indent = "Off"
# Enable live logging during test execution
log_cli = false
log_cli_date_format = "%Y-%m-%d %H:%M:%S"
log_cli_format = "%(asctime)s [%(levelname)8s] %(message)s"
log_cli_level = "INFO"
log_date_format = "%Y-%m-%d %H:%M:%S"
# File logging configuration
log_file = "logs/pytest.log"
log_file_date_format = "%Y-%m-%d %H:%M:%S"
log_file_format = "%(asctime)s [%(levelname)8s] %(name)s:%(lineno)d - %(message)s"
log_file_level = "DEBUG"
log_file_mode = "w"
# Captured log format (displayed on test failure)
log_format = "%(asctime)s [%(levelname)8s] %(name)s - %(message)s"
log_level = "INFO"
# Test markers for categorizing tests
markers = [
  "database: Tests requiring database setup",
  "integration: Integration tests involving multiple components",
  "network: Tests requiring network access",
  "slow: Tests that take significant time (>1s)",
  "unit: Fast isolated unit tests (default)",
]
# Minimum pytest version required
minversion = "9.0"
# Avoid recursing into these directories during test collection
norecursedirs = [
  "*.egg",
  ".*",
  ".venv",
  "__pycache__",
  "build",
  "dist",
  "docs",
  "node_modules",
  "proto",
  "venv",
]
python_classes = ["Test*"]
# Test discovery patterns
python_files = ["*_test.py", "test_*.py"]
python_functions = ["test_*"]
# Add source directory to Python path for imports
pythonpath = ["src"]
# Required plugins
required_plugins = [
  "pytest-cov>=7.0.0",
]
# enable "strict mode"
strict = true
# Directories to search for tests
testpaths = ["tests"]
tmp_path_retention_count = "3"
# Temporary directory retention
tmp_path_retention_policy = "failed"
# Truncation limits for assertion messages
truncation_limit_chars = 640
truncation_limit_lines = 8
# Assertion output configuration
verbosity_assertions = "auto"
verbosity_test_cases = "auto"
